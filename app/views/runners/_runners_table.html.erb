<% path = case controller
when "club" then club_path(club)
when "category" then category_path(category)
else runners_path
end %>

<%= form_tag path, method: :get, id: 'runners_search_form' do %>
 <%= text_field_tag :search, params[:search], id: 'show_search', placeholder: "Cauta dupa Nume sau Prenume", class: "form-control mb-2", table_type: "runners"%>
 <%= submit_tag "Cauta", class: "btn btn-info" %>
<hr>
<% unless controller == "club" %>
<%= label_tag "club_id", "Clubul", class: "label-filter" %>
<%= select_tag :club_id, options_for_select(Club.pluck(:club_name, :id), params[:club_id]), include_blank: "Toate Cluburile", class: "custom-select" %>
<br>
 <% end %>
<% unless controller == "category" %>
<%= label_tag "category_id", "Categoria actuală", class: "label-filter" %>
<%= select_tag :category_id, options_for_select(Category.pluck(:category_name, :id), params[:category_id]), include_blank: "Toate Categoriile",class: "custom-select" %>
<br>
<% end %>
<%= label_tag "best_category_id", "Titlul Sportiv", class: "label-filter" %>
<%= select_tag :best_category_id, options_for_select(Category.pluck(:category_name, :id), params[:best_category_id]), include_blank: "Toate Categoriile",class: "custom-select" %>
<br>
<%= label_tag "gender", "Genul", class: "label-filter" %>
<%= select_tag :gender, options_for_select(["M", "W"], params[:gender]), include_blank: "Toate Genurile", class: "custom-select" %>
<br>
<%= label_tag "wre", "WRE ID",class: "label-filter" %>
<%= check_box_tag :wre, true, params[:wre], id: "wre" %>
<br>
<%= label_tag "dob[from]", "Data nasterii: De la", class: "label-filter", for: "dob[from]" %>
<%= text_field_tag "dob[from]", params.dig("dob", "from") , id: 'dob[from]', placeholder: "zz/ll/aaaa", class: "datepicker custom-select" %>
<%= label_tag "dob[to]", "Pina la", class: "label-filter", for: "dob[to]" %>
<%= text_field_tag "dob[to]", params.dig("dob","to"), id: "dob[to]", placeholder: "zz/ll/aaaa", class: "datepicker custom-select" %>
<br>
<%= submit_tag "Filtreaza", class: "btn btn-info" %>
<% end %>
<table class="table table-striped table-bordered table-hover" id="runners-table">
    <thead class="table-primary">
        <tr>
            <th scope="col" class="sortable" data-sort-by="id">
                <%= link_to 'FOS ID' %>
            </th>
            <th class="sortable" data-sort-by="runner">
                <%= link_to 'Nume' %>
            </th>
            <th class="sortable" data-sort-by="gender">
                <%= link_to 'Genul' %>
            </th>
            <th class="sortable" data-sort-by="dob">
                <%= link_to 'Data Nastere'%>
            </th>
            <% unless controller == "club" %>
            <th class="sortable" data-sort-by="club">
                <%= link_to 'Club' %>
            </th>
            <% end %>
            <th class="sortable" data-sort-by="best_category_id">
                <%= link_to 'Titlul Sportiv' %>
            </th>
            <% unless controller == "category" %>
            <th class="sortable" data-sort-by="category_id">
                <%= link_to 'Categorie Valida' %>
            </th>
            <% end %>
            <th class="sortable" data-sort-by="category_valid">
                <%= link_to 'Valabilitate ' %>
            </th>
            <th class="sortable" data-sort-by="wre_id">
                <%= link_to 'WRE ID' %>
            </th>
            <th class="sortable" data-sort-by="sprint_wre_rang">
                <%= link_to 'Sprint WRE' %>
            </th>
            <th class="sortable" data-sort-by="forest_wre_rang">
                <%= link_to 'Padure WRE' %>
            </th>
            <% unless controller %>
            <th colspan="3">Acțiuni</th>
             <% end %>
        </tr>
    </thead>
    <tbody>
        <% runners.each do |runner| %>
        <tr>
            <td>
                <%= runner.id %>
            </td>
            <td>
                <%= "#{runner.runner_name} #{runner.surname}" %>
            </td>
            <td>
                <%= runner.gender %>
            </td>
            <td>
                <%= runner.dob.strftime("%d/%m/%Y") %>
            </td>
            <% unless controller == "club" %>
            <td>
                <%= link_to runner.club&.club_name, runner.club %>
            </td>
            <% end %>
            <td>
                <%= Category.find_by_id(runner.best_category_id)&.category_name %>
            </td>
            <% unless controller == "category" %>
            <td>
                <%= runner.category.category_name %>
            </td>
            <% end %>
            <td>
                <%= runner.category_valid&.strftime("%d/%m/%Y") %>
            </td>
            <td>
                <%= runner.wre_id %>
            </td>
            <td>
                <%= "#{runner.sprint_wre_place}/#{runner.sprint_wre_rang}p" %>
            </td>
            <td>
                <%= "#{runner.forest_wre_place}/#{runner.forest_wre_rang}p" %>
            </td>
             <% unless controller  %>
            <td>
                <%= link_to 'Arată', runner, class: "btn btn-warning btn-sm"%>
            </td>
            <% if admin_user? || club_admin?(runner.club) %>
            <td>
                <%= link_to 'Editează', edit_polymorphic_path(runner), class: "btn btn-success btn-sm"%>
            </td>
            <td>
                <%= link_to 'Șterge', runner, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger btn-sm" %>
            </td>
            <% end %>
             <% end %>
        </tr>
        <% end %>
    </tbody>
    <% if show_pagination %>
    <div class="pagination">
        <%= will_paginate runners, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
    </div>
    <% end %>
</table>
